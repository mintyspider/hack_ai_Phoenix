## Программа request.py

### Описание программы

Эта программа выполняет следующие задачи:

1. Подключается к базе данных Microsoft Access, содержащей справочник товаров.
2. Извлекает данные из таблицы товаров и строит логическое отношение для дальнейшего использования.
3. Позволяет пользователю вводить свойства товаров для поиска товаров, соответствующих введённым характеристикам.
4. Выполняет логический запрос на основе введённых пользователем свойств с использованием библиотеки логического программирования `kanren`.

### Компоненты программы

1. **Импорт библиотек**
    - `pyodbc`: Для подключения к базе данных Microsoft Access и выполнения SQL-запросов.
    - `kanren`: Для логического программирования, создания отношений между товарами и их свойствами.
    - `sympy`: Для возможных математических вычислений и работы с формулами.
2. **Переменные и подключение к базе данных**
    - `item_type`: Переменная, представляющая тип товаров (например, название таблицы, с которой ведётся работа).
    - `connect_str`: Строка подключения к базе данных Access через драйвер ODBC.
    - `conn` и `cursor`: Объекты для подключения к базе данных и выполнения SQL-запросов.
3. **Извлечение данных из таблицы**
    - SQL-запрос через переменную `query` извлекает все данные из таблицы товаров, связанной с `item_type`.
    - Результаты запроса сохраняются в переменной `rows`.
4. **Создание логического отношения**
    - С помощью объекта `items_relation` создаётся логическое отношение, представляющее товары и их свойства.
    - Функция `facts()` из библиотеки `kanren` добавляет факты (товары и их свойства) в логическое отношение.
5. **Сбор всех свойств товаров**
    - Программа извлекает свойства всех товаров и сохраняет их в множестве `all_properties`.
6. **Пользовательский ввод и проверка свойств**
    - Пользователь вводит свойства товаров, по которым будет выполняться поиск.
    - Введённые свойства проверяются на наличие в множестве `all_properties`. Если свойства не найдены, программа сообщает об этом.
7. **Логическое программирование и поиск товаров**
    - Функция `properties_compare()` выполняет логический запрос с использованием библиотеки `kanren`, проверяя соответствие товаров введённым свойствам.
    - Программа выводит результаты поиска, если такие товары найдены.
8. **Вывод результатов**
    - Если товары, соответствующие введённым свойствам, найдены, программа выводит их на экран.
    - Если таких товаров нет, программа выводит сообщение об отсутствии результатов.

### Функции программы

- **`properties_compare(*properties)`**
    - Описание: Функция принимает список свойств и возвращает товары, которые им соответствуют.
    - Параметры: `*properties` — список свойств для сравнения.
    - Возвращаемое значение: Список товаров, соответствующих введённым пользователем свойствам.

### Пример работы программы

1. Программа подключается к базе данных Access и загружает все товары из таблицы.
2. Пользователь вводит свойства товаров (например, "питьевая", "газированная").
3. Программа проверяет наличие этих свойств и выводит список товаров, соответствующих критериям.

### Проектируемые улучшения

1. **Добавить проверку наличия базы данных** перед началом работы программы. Это позволит избежать ошибок при отсутствии файла базы.
2. **Реализовать обработку ошибок** при подключении к базе данных и выполнении SQL-запросов, используя блоки `try-except`, чтобы программа не прерывалась при ошибке.
3. **Добавить поддержку более сложных логических запросов**, чтобы программа могла обрабатывать не только наличие свойств, но и более сложные правила логики (например, поиск товаров по комбинации свойств).

---

## Программа fill_properties.py

### Описание программы

Эта программа автоматизирует процесс сравнения данных между двумя базами данных Microsoft Access, обновляет свойства товаров на основе данных из текстового файла и выполняет SQL-запросы для извлечения и обновления данных в таблицах.

### Структура программы

Программа состоит из следующих функций:

1. **`update_property(db_path, table_name, row_id, column, value)`**:
    - Описание: Обновляет значение в указанном столбце и строке базы данных Access.
    - **Параметры**:
        - `db_path (str)`: Путь к базе данных Access.
        - `table_name (str)`: Название таблицы, в которой нужно обновить данные.
        - `row_id (int)`: Идентификатор строки, где нужно внести изменения.
        - `column (str)`: Название столбца для обновления.
        - `value (str)`: Новое значение для указанного столбца.
    - **Возвращаемое значение**: `None`.
2. **`query_database(db_path, query)`**:
    - Описание: Выполняет SQL-запрос к базе данных Access и возвращает результаты.
    - **Параметры**:
        - `db_path (str)`: Путь к базе данных Access.
        - `query (str)`: SQL-запрос для выполнения.
    - **Возвращаемое значение**: Список строк, содержащий результаты запроса.
3. **`fill_properties_cells(db_path1, db_path2, query1, query2, param_query, text_file, table_name, parametrs_table_name)`**:
    - Описание: Сравнивает данные из двух баз данных, обновляет свойства товаров на основе текстового файла и записывает их в базу данных.
    - **Параметры**:
        - `db_path1 (str)`: Путь к первой базе данных.
        - `db_path2 (str)`: Путь ко второй базе данных.
        - `query1 (str)`: SQL-запрос для первой базы данных.
        - `query2 (str)`: SQL-запрос для второй базы данных.
        - `param_query (str)`: SQL-запрос для получения параметров.
        - `text_file (str)`: Путь к текстовому файлу с данными для сравнения.
        - `table_name (str)`: Название таблицы для обновления.
        - `parametrs_table_name (str)`: Название таблицы с параметрами для обновления.
    - **Возвращаемое значение**: `None`.
4. **`main()`**:
    - Описание: Главная функция, вызывающая логику программы с передачей параметров.
    - **Возвращаемое значение**: `None`.

### Пример использования

1. Задайте путь к базе данных Access для двух баз:
    ```python
    db_path1 = r"C:\path\to\first_database.accdb" 
    db_path2 = r"C:\path\to\second_database.accdb"
    ```
    
2. Укажите SQL-запросы для извлечения данных из этих баз:        
	```python
	query1 = "SELECT * FROM OKPD_2" 
	query2 = "SELECT * FROM OKPD_2" 
	param_query = "SELECT * FROM Parametrs"
	```
3. Определите путь к текстовому файлу:
    
    `text_file = "1.txt"`
    
4. Укажите имена таблиц для обновления:
    
    `table_name = "Parametrs" parametrs_table_name = "Properties"`
    
5. Запустите основную функцию программы:
    
    ```python
	fill_properties_cells(db_path1, db_path2, query1, query2, param_query, text_file, table_name, parametrs_table_name)
    ```

### Особенности

- Программа использует `pyodbc` для подключения к базам данных Microsoft Access и работы с SQL-запросами.
- Обновление свойств производится на основе сопоставления данных между двумя таблицами. Пустые значения в столбцах заполняются автоматически.
- Программа поддерживает загрузку параметров из текстового файла и их использование для обновления базы данных.

### Проектируемые улучшения

1. **Добавить обработку ошибок и логирование**: Обернуть критические участки программы в блоки `try-except` для обработки ошибок и добавить логирование для удобства отладки.
2. **Оптимизировать работу с базой данных**: Минимизировать количество подключений к базе данных, используя одно соединение для всех операций.
3. **Гибкость в управлении столбцами**: Добавить возможность динамически выбирать, какие столбцы обновлять и какие параметры использовать для сравнения.

---
 
## Программа make_group.py

### Описание программы

Эта программа выполняет две основные задачи:

1. Извлечение первого слова из текстового столбца в базе данных Access и запись его в новый столбец.
2. Использование TF-IDF для анализа текстовых данных и выбора ключевого слова, которое будет использоваться в качестве названия группы.

### Компоненты программы

#### 1. **Функция `connect_to_access_db(db_path)`**

Эта функция подключается к базе данных Microsoft Access, используя библиотеку `pyodbc`.

- **Параметры:**
    
    - `db_path (str)`: Путь к базе данных Access.
- **Возвращаемое значение:**
    
    - `conn`: Объект подключения к базе данных Access.
- **Пример использования:**
    
    `conn = connect_to_access_db(r"C:\path\to\database.accdb")`
    

#### 2. **Функция `extract_first_word(db_path, table_name, source_column, target_column)`**

Эта функция извлекает первое слово из текстового столбца базы данных и записывает его в новый столбец.

- **Параметры:**
    
    - `db_path (str)`: Путь к базе данных Access.
    - `table_name (str)`: Имя таблицы, из которой будут извлекаться данные.
    - `source_column (str)`: Имя исходного столбца с текстовыми данными.
    - `target_column (str)`: Имя целевого столбца, куда будет записано первое слово.
- **Шаги выполнения:**
    
    1. Подключение к базе данных через функцию `connect_to_access_db`.
    2. Проверка, существует ли целевой столбец. Если нет, он создаётся с типом `TEXT`.
    3. Извлечение всех строк из исходного столбца и извлечение первого слова.
    4. Обновление нового столбца с записанным первым словом.
    5. Сохранение изменений и закрытие соединения.
- **Пример использования:**
    
    `extract_first_word(r"C:\path\to\database.accdb", "Товары", "Название", "ПерваяЧасть")`
    


#### 3. **Функция `choose_group_name(documents)`**

Эта функция использует TF-IDF (Term Frequency-Inverse Document Frequency) для извлечения ключевого слова из набора текстов. Она возвращает ключевое слово с наивысшим значением TF-IDF, которое может быть использовано как название группы.

- **Параметры:**
    
    - `documents (list)`: Список строк, представляющих текстовые данные.
- **Шаги выполнения:**
    
    1. Создание объекта `TfidfVectorizer` для вычисления TF-IDF.
    2. Применение TF-IDF к текстовым данным с помощью метода `fit_transform()`.
    3. Извлечение уникальных терминов и их TF-IDF значений.
    4. Сортировка терминов по значениям TF-IDF в порядке убывания.
    5. Возврат ключевого слова с наивысшим значением TF-IDF.
- **Пример использования:**
    ```python
    documents = [
	    "ВОДА ПРИРОДНАЯ ПИТЬЕВАЯ",
	    "ВОДА ГАЗИРОВАННАЯ",
        "ВОДА ЧИСТАЯ" 
	]  
	group_name = choose_group_name(documents)
	```
    
- **Возвращаемое значение:**
    
    - `group_name (str)`: Ключевое слово с наивысшим значением TF-IDF.


### Пример использования программы

1. **Извлечение первого слова из текста:**
    
    ```python
    db_path = r"C:\path\to\database.accdb" 
    table_name = "Группы" 
    source_column = "Товар" 
    target_column = "Группа"  
    extract_first_word(db_path, table_name, source_column, target_column)
    ```
    
2. **Выбор ключевого слова для группы на основе TF-IDF:**

    ```python
    documents = [
       "ВОДА ПРИРОДНАЯ ПИТЬЕВАЯ АРТЕЗИАНСКАЯ ПЕРВОЙ КАТЕГОРИИ НЕГАЗИРОВАННАЯ",
       "ВОДА ПИТЬЕВАЯ",   
       "ВОДА ЧИСТАЯ",   
       "ВОДА ПИТЬЕВАЯ ПРИРОДНАЯ",   
       "ВОДА ПИТЬЕВАЯ НЕГАЗИРОВАННАЯ",   
       "ВОДА ПИТЬЕВАЯ ГАЗИРОВАННАЯ" 
    ]  
    group_name = choose_group_name(documents) 
    print("Название группы:", group_name)
    ```

### Проектируемые улучшения

1. **Обработка ошибок**:

    - Добавить блоки `try-except` для обработки возможных исключений (например, ошибок подключения к базе данных или неверного формата текста).
2. **Оптимизация работы с базой данных**:

    - Создать одно постоянное соединение с базой данных на время выполнения всех операций вместо открытия/закрытия его в каждой функции.
3. **Улучшение TF-IDF анализа**:

    - Добавить поддержку настройки параметров для `TfidfVectorizer` (например, `ngram_range`, удаление стоп-слов), чтобы улучшить анализ текста и точность выбора ключевых слов.
